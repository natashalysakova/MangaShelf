@using MangaShelf.Components.Pages
@using MangaShelf.DAL.Models
@using System.Security.Claims

@inject IVolumePageLocalizationService Localizer

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">@Localizer["LogReading"]</MudText>
    </TitleContent>
    <DialogContent>
        <MudSelect @bind-Value="@Reading.Status">
            @foreach (var status in Enum.GetValues(typeof(ReadingStatus)).Cast<ReadingStatus>())
            {
                <MudSelectItem Value="status">@Localizer[status]</MudSelectItem>
            }
        </MudSelect>
        @switch(Reading.Status)
        {
            case ReadingStatus.PlanToRead:
                break;
            case ReadingStatus.Reading:
                <MudStack Row>
                    <MudDatePicker @bind-Date="@selectedStartDate"></MudDatePicker>
                </MudStack>
                <MudRating @bind-SelectedValue="@_selectedRating"></MudRating>
                <MudTextField @bind-Value="@Reading.Review"></MudTextField>
                break;
            case ReadingStatus.Completed
            or ReadingStatus.Dropped or ReadingStatus.OnHold:
                <MudStack Row>
                    <MudDatePicker @bind-Date="@selectedStartDate"></MudDatePicker>
                    <MudDatePicker @bind-Date="@selectedEndDate"></MudDatePicker>
                </MudStack>
                <MudRating @bind-SelectedValue="@_selectedRating"></MudRating>
                <MudTextField @bind-Value="@Reading.Review"></MudTextField>
                break;
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@Localizer["Cancel"]</MudButton>
        <MudButton OnClick="Submit" Variant="Variant.Filled" Color="@Color.Primary">@Localizer["Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    private DateTime? selectedStartDate = DateTime.Now;
    private DateTime? selectedEndDate = DateTime.Now;

    private int _selectedRating;

    [Parameter]
    public Reading Reading { get; set; }

    private void Submit()
    {
        Reading.StartedAt = DateTime.SpecifyKind(selectedStartDate.Value, DateTimeKind.Utc);
        Reading.FinishedAt = DateTime.SpecifyKind(selectedEndDate.Value, DateTimeKind.Utc);
        Reading.Rating = _selectedRating;

        MudDialog.Close(DialogResult.Ok(Reading));
    }

    private void Cancel() => MudDialog.CancelAll();

}