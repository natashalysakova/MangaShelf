@using MangaShelf.Components.Pages
@using MangaShelf.DAL.Models
@using System.Security.Claims

@inject IUiLocalizationService Localizer

@if (Volumes != null)
{
    <MudText Typo="Typo.h5" Class="mb-4">@Localizer["MoreInSeries"]</MudText>
    <MangaLine Volumes="Volumes" ItemsPerLine="5"></MangaLine>
}
else
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}

@code {

    [Parameter]
    [EditorRequired]
    public required VolumeDto Volume { get; set; }


    [Inject]
    public required IVolumeService VolumeService { get; set; }

    private IEnumerable<CardVolumeDto> Volumes { get; set; }


    override protected async Task OnParametersSetAsync()
    {
        await LoadMoreVolumes();
    }

    private async Task LoadMoreVolumes()
    {
        try
        {
            var result = await VolumeService.GetVolumesBySeriesId(Volume.Series.Id);
            var toRemove = result.Where(x => x.Id == Volume.Id);
            result = result.Except(toRemove);

            Volumes = result;
        }
        catch (Exception)
        {
            throw;
        }
    }
}